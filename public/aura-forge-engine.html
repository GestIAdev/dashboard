<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∏ SELENE SONG FORGE - Music Engine Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/midi-parser-js@4.0.4/src/main.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/aura-forge-engine.css">
</head>
<body>
    <!-- Scan Line Effect - DISABLED -->
    <!-- <div class="scan-line"></div> -->
    
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="header-title">üé∏ SELENE SONG FORGE</h1>
                <p class="header-subtitle">"Evolution Through Beauty and Intelligence"</p>
            </div>
            <div class="header-right">
                <div class="mode-indicator">
                    <span class="mode-label">Active Mode:</span>
                    <span class="mode-badge" id="currentMode">LOADING...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        
        <!-- Left Column: Control Panel + History -->
        <div class="left-column">
            
            <!-- Control Panel -->
            <section class="control-panel">
                <h2 class="section-title">
                    <span class="icon">üéπ</span> CONTROL PANEL
                </h2>
                
                <div class="control-content">
                    <!-- Style Preset Selector -->
                    <div class="control-group">
                        <label class="control-label">
                            <span class="icon">üé®</span> Style Preset
                        </label>
                        <select id="stylePreset" class="cyberpunk-select">
                            <option value="">Loading presets...</option>
                        </select>
                        <div class="preset-description" id="presetDesc">
                            Select a preset to see description
                        </div>
                    </div>

                    <!-- Duration Slider -->
                    <div class="control-group">
                        <label class="control-label">
                            <span class="icon">‚è±Ô∏è</span> Duration
                            <span class="value-display" id="durationValue">60s</span>
                        </label>
                        <input type="range" 
                               id="duration" 
                               class="cyberpunk-slider"
                               min="30" 
                               max="300" 
                               value="60" 
                               step="5">
                        <div class="slider-labels">
                            <span>30s</span>
                            <span>150s</span>
                            <span>300s</span>
                        </div>
                    </div>

                    <!-- Advanced Options (Collapsible) -->
                    <div class="control-group advanced-section">
                        <button class="advanced-toggle" id="advancedToggle">
                            <span class="icon">‚öôÔ∏è</span> Advanced Options
                            <span class="toggle-arrow">‚ñº</span>
                        </button>
                        <div class="advanced-content" id="advancedContent" style="display: none;">
                            <!-- Seed Input -->
                            <div class="control-group">
                                <label class="control-label">
                                    <span class="icon">üé≤</span> Seed (Optional)
                                    <span class="tooltip" title="Same seed = same music">‚ÑπÔ∏è</span>
                                </label>
                                <div class="input-with-button">
                                    <input type="number" 
                                           id="seed" 
                                           class="cyberpunk-input"
                                           placeholder="Random (leave empty)"
                                           min="0"
                                           max="999999999">
                                    <button class="btn-secondary" id="randomSeed">üé≤</button>
                                </div>
                            </div>

                            <!-- Complexity (Optional Override) -->
                            <div class="control-group">
                                <label class="control-label">
                                    <span class="icon">üß©</span> Complexity Override
                                </label>
                                <input type="range" 
                                       id="complexity" 
                                       class="cyberpunk-slider small"
                                       min="0" 
                                       max="100" 
                                       value="50">
                                <div class="slider-value">
                                    <span id="complexityValue">0.5</span>
                                </div>
                            </div>

                            <!-- Beauty (Optional Override) -->
                            <div class="control-group">
                                <label class="control-label">
                                    <span class="icon">‚ú®</span> Beauty Override
                                </label>
                                <input type="range" 
                                       id="beauty" 
                                       class="cyberpunk-slider small"
                                       min="0" 
                                       max="100" 
                                       value="70">
                                <div class="slider-value">
                                    <span id="beautyValue">0.7</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <button class="btn-primary generate-btn" id="generateBtn">
                        <span class="icon">üöÄ</span>
                        <span class="text">GENERATE SYMPHONY</span>
                        <span class="loading-spinner" style="display:none">‚ö°</span>
                    </button>
                </div>
            </section>

            <!-- Generation History -->
            <section class="history-panel">
                <h3 class="section-title">
                    <span class="icon">üìú</span> Generation History
                </h3>
                <div class="history-list" id="historyList">
                    <div class="history-empty">
                        No generations yet. Create your first symphony!
                    </div>
                </div>
            </section>
        </div>

        <!-- Right Column: Status + Output -->
        <div class="right-column">
            
            <!-- Generation Status -->
            <section class="status-panel">
                <div class="status-header">
                    <span class="icon">‚ö°</span>
                    <span class="status-text" id="statusText">IDLE</span>
                </div>
                
                <!-- Progress Bar (shown during generation) -->
                <div class="progress-container" id="progressContainer" style="display:none">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width:0%"></div>
                    </div>
                    <div class="progress-info">
                        <span id="progressPercent">0%</span>
                        <span id="estimatedTime">Estimated: calculating...</span>
                    </div>
                </div>
                
                <!-- Last Generated Info -->
                <div class="last-generated" id="lastGenerated" style="display:none">
                    <h4>Last Generated:</h4>
                    <ul class="info-list">
                        <li>Duration: <span id="lastDuration">--</span></li>
                        <li>Tempo: <span id="lastTempo">--</span> BPM</li>
                        <li>Key: <span id="lastKey">--</span></li>
                        <li>Seed: <span id="lastSeed">--</span></li>
                    </ul>
                </div>

                <!-- Error Display -->
                <div class="error-display" id="errorDisplay" style="display:none">
                    <span class="icon">‚ö†Ô∏è</span>
                    <span class="error-message" id="errorMessage"></span>
                </div>
            </section>

            <!-- MIDI Output -->
            <section class="midi-output" id="midiOutput" style="display:none">
                <div class="output-header">
                    <h3 class="output-title" id="outputTitle">Cyberpunk Dream #1234567</h3>
                    <span class="output-timestamp" id="outputTimestamp">2025-10-26 03:15:42</span>
                </div>
                
                <!-- MIDI Player -->
                <div class="midi-player">
                    <div class="player-controls">
                        <button class="player-btn" id="playBtn" title="Play">‚ñ∂Ô∏è</button>
                        <button class="player-btn" id="pauseBtn" style="display:none" title="Pause">‚è∏Ô∏è</button>
                        <button class="player-btn" id="stopBtn" title="Stop">‚èπÔ∏è</button>
                    </div>
                    <div class="player-timeline">
                        <div class="timeline-bar" id="timelineBar">
                            <div class="timeline-progress" id="timelineProgress" style="width:0%"></div>
                        </div>
                        <div class="timeline-time">
                            <span id="currentTime">0:00</span>
                            <span>/</span>
                            <span id="totalTime">0:00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Metadata -->
                <div class="output-metadata">
                    <h4>Metadata:</h4>
                    <div class="metadata-grid">
                        <div class="meta-item">
                            <span class="meta-label">Style:</span>
                            <span class="meta-value" id="metaStyle">--</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Mode:</span>
                            <span class="meta-value" id="metaMode">--</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Structure:</span>
                            <span class="meta-value" id="metaStructure">--</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Complexity:</span>
                            <span class="meta-value" id="metaComplexity">--</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Beauty:</span>
                            <span class="meta-value" id="metaBeauty">--</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Tempo:</span>
                            <span class="meta-value" id="metaTempo">--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="output-actions">
                    <button class="btn-action download-btn" id="downloadBtn">
                        üíæ DOWNLOAD .MID
                    </button>
                    <button class="btn-action copy-btn" id="copySeedBtn">
                        üîó COPY SEED
                    </button>
                    <button class="btn-action view-notes-btn" id="viewNotesBtn">
                        üéπ VIEW NOTES
                    </button>
                    <button class="btn-action delete-btn" id="deleteOutputBtn" onclick="deleteCurrentOutput()">
                        üóëÔ∏è DELETE OUTPUT
                    </button>
                    <button class="btn-action regenerate-btn" id="regenerateBtn">
                        üîÑ REGENERATE
                    </button>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal for Piano Roll (Future Enhancement) -->
    <div class="modal" id="pianoRollModal" style="display:none">
        <div class="modal-content">
            <span class="modal-close" id="modalClose">&times;</span>
            <h2>Piano Roll View</h2>
            <canvas id="pianoRollCanvas" width="800" height="400"></canvas>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@tonejs/midi@2.0.28/build/Midi.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <!-- üîß BUG #24 FIX: RENAMED FILE to force cache-bust -->
    <script type="module" src="js/aura-forge/aura-player-v2.js"></script>
    <script type="module" src="js/aura-forge/aura-ui.js?v=2025110202"></script>
</body>
</html>
